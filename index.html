<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#dc3545">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="iNet">
    <title>iNet</title>
    <link rel="manifest" href="data:application/json;charset=utf-8,%7B%22name%22%3A%22iNet%22%2C%22short_name%22%3A%22iNet%22%2C%22start_url%22%3A%22.%2F%22%2C%22display%22%3A%22standalone%22%2C%22background_color%22%3A%22%23dc3545%22%2C%22theme_color%22%3A%22%23dc3545%22%2C%22icons%22%3A%5B%7B%22src%22%3A%22data%3Aimage%2Fsvg%2Bxml%2C%253Csvg%2520xmlns%3D%27http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%27%2520width%3D%27192%27%2520height%3D%27192%27%253E%253Crect%2520width%3D%27192%27%2520height%3D%27192%27%2520fill%3D%27%2523dc3545%27%2F%253E%253Ctext%2520x%3D%2750%2525%27%2520y%3D%2750%2525%27%2520font-size%3D%27140%27%2520font-family%3D%27system-ui%27%2520fill%3D%27white%27%2520text-anchor%3D%27middle%27%2520dy%3D%27.35em%27%253Ei%253C%2Ftext%253E%253C%2Fsvg%253E%22%2C%22sizes%22%3A%22192x192%22%2C%22type%22%3A%22image%2Fsvg%2Bxml%22%7D%5D%7D">
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32'%3E%3Crect width='32' height='32' fill='%23dc3545'/%3E%3Ctext x='50%25' y='50%25' font-size='24' font-family='system-ui' fill='white' text-anchor='middle' dy='.35em'%3Ei%3C/text%3E%3C/svg%3E">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #fff;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(180deg, #2c2c2e 0%, #1c1c1e 100%);
            padding: 15px 20px;
            color: white;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .logo {
            width: 35px;
            height: 35px;
            background: #dc3545;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 300;
        }
        .header h1 { font-size: 20px; font-weight: 500; flex: 1; }
        
        .main { flex: 1; overflow-y: auto; background: #f8f9fa; }
        
        .signup {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            padding: 40px 20px;
            background: white;
        }
        .signup .logo-big {
            width: 120px;
            height: 120px;
            background: #dc3545;
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 80px;
            font-weight: 300;
            color: white;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(220,53,69,0.3);
        }
        .signup h2 { font-size: 28px; margin-bottom: 10px; }
        .signup p { color: #666; text-align: center; margin-bottom: 30px; }
        .btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 16px 50px;
            font-size: 18px;
            border-radius: 25px;
            cursor: pointer;
        }
        
        .tab { display: none; padding: 20px; }
        .tab.active { display: block; }
        
        .empty { text-align: center; padding: 60px 20px; color: #999; }
        .empty .icon { font-size: 80px; margin-bottom: 20px; opacity: 0.3; }
        
        .card {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .my-pin {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        .my-pin .label { font-size: 14px; opacity: 0.9; margin-bottom: 8px; }
        .my-pin .pin { font-size: 36px; font-weight: 600; letter-spacing: 4px; }
        
        .call-item {
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        .call-item .avatar {
            width: 50px;
            height: 50px;
            background: #dc3545;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            font-weight: 500;
            margin-right: 15px;
        }
        .call-item .info { flex: 1; }
        .call-item .pin { font-size: 18px; font-weight: 500; }
        .call-item .time { font-size: 14px; color: #999; margin-top: 3px; }
        
        .nav {
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            padding: 8px 0;
        }
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px;
            cursor: pointer;
            border: none;
            background: none;
            color: #999;
        }
        .nav-item.active { color: #dc3545; }
        .nav-item .icon { font-size: 24px; margin-bottom: 4px; }
        .nav-item .label { font-size: 11px; }
        
        .fab {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: #dc3545;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 28px;
            box-shadow: 0 4px 15px rgba(220,53,69,0.4);
            cursor: pointer;
            border: none;
            z-index: 100;
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .overlay.show { display: flex; }
        
        .dialpad {
            background: white;
            border-radius: 20px 20px 0 0;
            width: 100%;
            max-width: 400px;
            padding: 30px 20px;
            position: absolute;
            bottom: 0;
        }
        .dial-display {
            font-size: 36px;
            text-align: center;
            padding: 20px;
            letter-spacing: 5px;
            min-height: 60px;
        }
        .dial-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        .dial-btn {
            aspect-ratio: 1;
            border: none;
            background: #f8f9fa;
            border-radius: 50%;
            font-size: 28px;
            cursor: pointer;
        }
        .dial-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .dial-actions button {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            cursor: pointer;
        }
        .btn-audio { background: #28a745; color: white; }
        .btn-video { background: #dc3545; color: white; }
        .btn-close { background: #6c757d; color: white; }
        
        .call-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(180deg, #2c2c2e 0%, #1c1c1e 100%);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 60px 20px 40px;
            z-index: 2000;
        }
        .call-screen.show { display: flex; }
        .call-screen .avatar-big {
            width: 150px;
            height: 150px;
            background: #dc3545;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 60px;
            font-weight: 500;
            margin-bottom: 30px;
        }
        .call-screen .pin {
            font-size: 32px;
            color: white;
            letter-spacing: 5px;
            margin-bottom: 10px;
        }
        .call-screen .status {
            font-size: 18px;
            color: #999;
            margin-bottom: 40px;
        }
        
        .call-controls {
            display: flex;
            gap: 20px;
        }
        .call-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: none;
            font-size: 30px;
            cursor: pointer;
        }
        .call-btn.hangup { background: #dc3545; color: white; }
        .call-btn.answer { background: #28a745; color: white; }
        
        .video-box {
            position: relative;
            width: 100%;
            max-width: 600px;
            aspect-ratio: 4/3;
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }
        .video-box video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .video-box .local-vid {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 120px;
            height: 90px;
            border-radius: 10px;
            border: 2px solid white;
        }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">i</div>
        <h1 id="hdr">iNet</h1>
    </div>

    <div class="main">
        <div id="signup" class="signup">
            <div class="logo-big">i</div>
            <h2>Welcome to iNet</h2>
            <p>Call anyone with just a PIN.<br>No phone number needed.</p>
            <button class="btn" onclick="doSignup()">Get Started</button>
            <div id="signup-msg" style="margin-top: 20px; color: #dc3545;"></div>
        </div>

        <div id="recent" class="tab">
            <div id="recent-list"></div>
            <div id="recent-empty" class="empty">
                <div class="icon">ðŸ“ž</div>
                <h3>No Recent Calls</h3>
            </div>
        </div>

        <div id="contacts" class="tab">
            <div class="my-pin">
                <div class="label">My PIN</div>
                <div class="pin" id="my-pin">------</div>
            </div>
            <div id="contacts-list"></div>
            <div id="contacts-empty" class="empty">
                <div class="icon">ðŸ‘¥</div>
                <h3>No Contacts</h3>
            </div>
        </div>
    </div>

    <div id="nav" class="nav hidden">
        <button class="nav-item active" onclick="switchTab('recent')">
            <div class="icon">ðŸ•’</div>
            <div class="label">Recent</div>
        </button>
        <button class="nav-item" onclick="switchTab('contacts')">
            <div class="icon">ðŸ‘¤</div>
            <div class="label">Contacts</div>
        </button>
    </div>

    <button id="fab" class="fab hidden" onclick="openDial()">ðŸ“ž</button>

    <div id="dialpad" class="overlay" onclick="if(event.target===this) closeDial()">
        <div class="dialpad" onclick="event.stopPropagation()">
            <div class="dial-display" id="disp"></div>
            <div class="dial-grid">
                <button class="dial-btn" onclick="dial('1')">1</button>
                <button class="dial-btn" onclick="dial('2')">2</button>
                <button class="dial-btn" onclick="dial('3')">3</button>
                <button class="dial-btn" onclick="dial('4')">4</button>
                <button class="dial-btn" onclick="dial('5')">5</button>
                <button class="dial-btn" onclick="dial('6')">6</button>
                <button class="dial-btn" onclick="dial('7')">7</button>
                <button class="dial-btn" onclick="dial('8')">8</button>
                <button class="dial-btn" onclick="dial('9')">9</button>
                <button class="dial-btn" onclick="dial('*')">*</button>
                <button class="dial-btn" onclick="dial('0')">0</button>
                <button class="dial-btn" onclick="backspace()">âŒ«</button>
            </div>
            <div class="dial-actions">
                <button class="btn-audio" onclick="call('audio')">ðŸŽ¤ Audio</button>
                <button class="btn-video" onclick="call('video')">ðŸ“¹ Video</button>
            </div>
            <div class="dial-actions">
                <button class="btn-close" onclick="closeDial()">Close</button>
            </div>
        </div>
    </div>

    <div id="call" class="call-screen">
        <div>
            <div class="avatar-big" id="call-avatar">?</div>
            <div class="pin" id="call-pin">------</div>
            <div class="status" id="call-status">Calling...</div>
        </div>
        <div id="video-box" class="video-box hidden">
            <video id="remote-vid" autoplay playsinline></video>
            <video id="local-vid" class="local-vid" autoplay playsinline muted></video>
        </div>
        <div class="call-controls">
            <button class="call-btn hangup" onclick="hangup()">âœ•</button>
        </div>
    </div>

    <div id="incoming" class="call-screen">
        <div>
            <div class="avatar-big">ðŸ“ž</div>
            <div class="pin" id="inc-pin">------</div>
            <div class="status">Incoming Call...</div>
        </div>
        <div class="call-controls">
            <button class="call-btn hangup" onclick="reject()">âœ•</button>
            <button class="call-btn answer" onclick="answer()">âœ“</button>
        </div>
    </div>

    <audio id="remote-audio" autoplay playsinline></audio>

    <script>
        const API = 'https://emltechstudio-inet.hf.space';
        const ICE = { iceServers: [{ urls: 'stun:stun.l.google.com:19302' }, { urls: 'turn:openrelay.metered.ca:80', username: 'openrelayproject', credential: 'openrelayproject' }] };

        let myPin = localStorage.getItem('myPin');
        let pc = null;
        let stream = null;
        let room = null;
        let pollTimer = null;
        let dialNum = '';
        let callType = 'audio';
        let contacts = JSON.parse(localStorage.getItem('contacts') || '[]');
        let recent = JSON.parse(localStorage.getItem('recent') || '[]');
        let incomingData = null;

        if (myPin) {
            document.getElementById('signup').style.display = 'none';
            document.getElementById('my-pin').textContent = myPin;
            switchTab('recent');
            renderRecent();
            renderContacts();
            startListen();
        }

        async function doSignup() {
            const msg = document.getElementById('signup-msg');
            msg.textContent = 'Creating PIN...';
            try {
                await navigator.mediaDevices.getUserMedia({ audio: true, video: true })
                    .then(s => s.getTracks().forEach(t => t.stop()));
                if ('Notification' in window) await Notification.requestPermission();

                const r = await fetch(API + '/api/signup', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ subscription: {} })
                });
                const d = await r.json();
                if (d.success && d.pin) {
                    myPin = d.pin;
                    localStorage.setItem('myPin', myPin);
                    document.getElementById('signup').style.display = 'none';
                    document.getElementById('my-pin').textContent = myPin;
                    switchTab('recent');
                    startListen();
                } else {
                    msg.textContent = 'Error: ' + (d.error || 'Failed');
                }
            } catch (e) {
                msg.textContent = 'Error: ' + e.message;
            }
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(tab).classList.add('active');
            document.querySelectorAll('.nav-item')[tab === 'recent' ? 0 : 1].classList.add('active');
            document.getElementById('hdr').textContent = tab === 'recent' ? 'Recent' : 'Contacts';
            document.getElementById('nav').classList.remove('hidden');
            document.getElementById('fab').classList.remove('hidden');
        }

        function openDial() {
            dialNum = '';
            document.getElementById('disp').textContent = '';
            document.getElementById('dialpad').classList.add('show');
        }

        function closeDial() {
            document.getElementById('dialpad').classList.remove('show');
        }

        function dial(n) {
            if (dialNum.length < 6) {
                dialNum += n;
                document.getElementById('disp').textContent = dialNum;
            }
        }

        function backspace() {
            dialNum = dialNum.slice(0, -1);
            document.getElementById('disp').textContent = dialNum;
        }

        async function call(type) {
            if (dialNum.length !== 6) {
                alert('Enter 6-digit PIN');
                return;
            }
            callType = type;
            closeDial();

            try {
                stream = await navigator.mediaDevices.getUserMedia({
                    audio: true,
                    video: type === 'video'
                });

                pc = new RTCPeerConnection(ICE);
                stream.getTracks().forEach(t => pc.addTrack(t, stream));

                if (type === 'video') {
                    document.getElementById('local-vid').srcObject = stream;
                    document.getElementById('video-box').classList.remove('hidden');
                }

                pc.ontrack = (e) => {
                    if (type === 'video') {
                        document.getElementById('remote-vid').srcObject = e.streams[0];
                    } else {
                        document.getElementById('remote-audio').srcObject = e.streams[0];
                    }
                    document.getElementById('call-status').textContent = 'Connected';
                };

                pc.oniceconnectionstatechange = () => {
                    if (pc.iceConnectionState === 'failed' || pc.iceConnectionState === 'disconnected') {
                        alert('Connection lost');
                        hangup();
                    }
                };

                pc.onicecandidate = (e) => {
                    if (e.candidate && room) {
                        fetch(API + '/api/ice', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                room_code: room,
                                candidate: e.candidate,
                                sender_pin: myPin
                            })
                        });
                    }
                };

                const offer = await pc.createOffer({ offerToReceiveAudio: true, offerToReceiveVideo: type === 'video' });
                await pc.setLocalDescription(offer);

                const r = await fetch(API + '/api/call', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        caller_pin: myPin,
                        callee_pin: dialNum,
                        offer: offer,
                        call_type: type
                    })
                });

                const d = await r.json();
                if (d.success && d.room_code) {
                    room = d.room_code;
                    document.getElementById('call-avatar').textContent = dialNum[0];
                    document.getElementById('call-pin').textContent = dialNum;
                    document.getElementById('call-status').textContent = 'Calling...';
                    document.getElementById('call').classList.add('show');
                    addRecent(dialNum, 'outgoing');
                    startPoll();
                } else {
                    alert('Call failed: ' + (d.error || 'Unknown error'));
                    hangup();
                }
            } catch (e) {
                alert('Error: ' + e.message);
                hangup();
            }
        }

        async function answer() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({
                    audio: true,
                    video: incomingData.call_type === 'video'
                });

                pc = new RTCPeerConnection(ICE);
                stream.getTracks().forEach(t => pc.addTrack(t, stream));

                pc.ontrack = (e) => {
                    if (incomingData.call_type === 'video') {
                        document.getElementById('remote-vid').srcObject = e.streams[0];
                    } else {
                        document.getElementById('remote-audio').srcObject = e.streams[0];
                    }
                };

                pc.onicecandidate = (e) => {
                    if (e.candidate && room) {
                        fetch(API + '/api/ice', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                room_code: room,
                                candidate: e.candidate,
                                sender_pin: myPin
                            })
                        });
                    }
                };

                await pc.setRemoteDescription(incomingData.offer);
                const ans = await pc.createAnswer({ offerToReceiveAudio: true, offerToReceiveVideo: incomingData.call_type === 'video' });
                await pc.setLocalDescription(ans);

                await fetch(API + '/api/answer', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        room_code: room,
                        answer: ans,
                        callee_pin: myPin
                    })
                });

                document.getElementById('incoming').classList.remove('show');
                document.getElementById('call-avatar').textContent = incomingData.caller_pin[0];
                document.getElementById('call-pin').textContent = incomingData.caller_pin;
                document.getElementById('call-status').textContent = 'Connected';
                document.getElementById('call').classList.add('show');

                if (incomingData.call_type === 'video') {
                    document.getElementById('local-vid').srcObject = stream;
                    document.getElementById('video-box').classList.remove('hidden');
                }

                addRecent(incomingData.caller_pin, 'incoming');
                startPoll();
            } catch (e) {
                alert('Error: ' + e.message);
                hangup();
            }
        }

        async function reject() {
            if (room) {
                await fetch(API + '/api/decline', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ room_code: room, pin: myPin })
                });
            }
            document.getElementById('incoming').classList.remove('show');
            room = null;
            incomingData = null;
        }

        function hangup() {
            if (room) {
                fetch(API + '/api/hangup', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ room_code: room, pin: myPin })
                });
            }
            if (pc) pc.close();
            if (stream) stream.getTracks().forEach(t => t.stop());
            if (pollTimer) clearInterval(pollTimer);
            pc = null;
            stream = null;
            room = null;
            document.getElementById('call').classList.remove('show');
            document.getElementById('video-box').classList.add('hidden');
        }

        function startPoll() {
            pollTimer = setInterval(async () => {
                try {
                    const r = await fetch(API + '/api/poll/' + room + '/' + myPin);
                    const d = await r.json();
                    if (d.hangup) {
                        alert('Call ended');
                        hangup();
                        return;
                    }
                    if (d.signals) {
                        for (const s of d.signals) {
                            if (s.type === 'answer') {
                                await pc.setRemoteDescription(s.data);
                                document.getElementById('call-status').textContent = 'Connected';
                            } else if (s.type === 'ice') {
                                await pc.addIceCandidate(s.data);
                            }
                        }
                    }
                } catch (e) {}
            }, 2000);
        }

        function startListen() {
            setInterval(async () => {
                if (room) return;
                try {
                    const r = await fetch(API + '/api/incoming/' + myPin);
                    const d = await r.json();
                    if (d.incoming) {
                        incomingData = d;
                        room = d.room_code;
                        document.getElementById('inc-pin').textContent = d.caller_pin;
                        document.getElementById('incoming').classList.add('show');
                        if ('Notification' in window && Notification.permission === 'granted') {
                            new Notification('Incoming Call', { body: 'From: ' + d.caller_pin });
                        }
                    }
                } catch (e) {}
            }, 3000);
        }

        function addRecent(pin, type) {
            recent.unshift({ pin, type, time: Date.now() });
            recent = recent.slice(0, 50);
            localStorage.setItem('recent', JSON.stringify(recent));
            renderRecent();
        }

        function renderRecent() {
            const list = document.getElementById('recent-list');
            const empty = document.getElementById('recent-empty');
            if (recent.length === 0) {
                list.innerHTML = '';
                empty.style.display = 'block';
                return;
            }
            empty.style.display = 'none';
            list.innerHTML = recent.map(c => {
                const date = new Date(c.time);
                const time = date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                const icon = c.type === 'incoming' ? 'ðŸ“²' : 'ðŸ“ž';
                return '<div class="card call-item" onclick="dialNum=\'' + c.pin + '\'; openDial(); document.getElementById(\'disp\').textContent=\'' + c.pin + '\';">' +
                    '<div class="avatar">' + c.pin[0] + '</div>' +
                    '<div class="info">' +
                        '<div class="pin">' + c.pin + '</div>' +
                        '<div class="time">' + time + '</div>' +
                    '</div>' +
                    '<div style="font-size:20px">' + icon + '</div>' +
                '</div>';
            }).join('');
        }

        function renderContacts() {
            const list = document.getElementById('contacts-list');
            const empty = document.getElementById('contacts-empty');
            if (contacts.length === 0) {
                list.innerHTML = '';
                empty.style.display = 'block';
                return;
            }
            empty.style.display = 'none';
            list.innerHTML = contacts.map(c => {
                return '<div class="card call-item" onclick="dialNum=\'' + c.pin + '\'; openDial(); document.getElementById(\'disp\').textContent=\'' + c.pin + '\';">' +
                    '<div class="avatar">' + c.name[0].toUpperCase() + '</div>' +
                    '<div class="info">' +
                        '<div class="pin">' + c.name + '</div>' +
                        '<div class="time">' + c.pin + '</div>' +
                    '</div>' +
                '</div>';
            }).join('');
        }

        // Service Worker
        if ('serviceWorker' in navigator) {
            const sw = 'self.addEventListener("install",()=>self.skipWaiting());self.addEventListener("activate",()=>self.clients.claim());';
            const blob = new Blob([sw], { type: 'application/javascript' });
            navigator.serviceWorker.register(URL.createObjectURL(blob));
        }
    </script>
</body>
    </html>
